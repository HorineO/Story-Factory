# 节点样式重构总结

## 重构概述

本次重构完成了节点系统的基础样式重构，实现了左右两侧布局和多层结构支持，提升了节点的可读性和功能性。

## 主要改进

### 1. 布局结构重构

#### 原有结构

```
┌─────────────────┐
│     头部        │
├─────────────────┤
│     主体内容    │
└─────────────────┘
```

#### 新结构

```
┌─────────────────────────────────────┐
│             节点头部                 │
├─────────────┬───────────────────────┤
│   左侧内容   │      右侧内容         │
│   区域      │       区域            │
│             │                       │
│  ┌─────────┐│ ┌─────────────────┐   │
│  │ 输入层1  ││ │    输出层1      │   │
│  └─────────┘│ └─────────────────┘   │
│             │                       │
│  ┌─────────┐│ ┌─────────────────┐   │
│  │ 输入层2  ││ │    输出层2      │   │
│  └─────────┘│ └─────────────────┘   │
│             │                       │
│  ┌─────────┐│ ┌─────────────────┐   │
│  │ 输入层3  ││ │    输出层3      │   │
│  └─────────┘│ └─────────────────┘   │
└─────────────┴───────────────────────┘
    ●           ●           ●
  输入1        输入2        输出1
```

### 2. 核心功能特性

#### ✅ 左右两侧布局

- 节点内容分为左右两个独立区域
- 左侧区域显示输入相关内容
- 右侧区域显示输出相关内容
- 清晰的数据流向可视化

#### ✅ 多层结构支持

- 每个区域可以包含多个内容层
- 支持复杂的节点逻辑和数据流
- 内容层可以独立配置和样式化

#### ✅ 连接点对齐机制

- 左侧连接点与左侧内容层垂直对齐
- 右侧连接点与右侧内容层垂直对齐
- 支持多层连接点，每个连接点对应一个内容层
- 连接点位置根据内容层数量自动计算

#### ✅ 增强的视觉效果

- 更大的节点尺寸和更好的可读性
- 增强的阴影和边框效果
- 悬停动画和交互反馈
- 连接点标签支持

#### ✅ 响应式设计

- 适配不同屏幕尺寸
- 移动端友好的布局调整
- 保持功能完整性的同时优化显示效果

## 技术实现

### 1. CSS 样式重构

#### 新增样式类

```css
.node-left-content     /* 左侧内容区域 */
/* 左侧内容区域 */
/* 左侧内容区域 */
/* 左侧内容区域 */
.node-right-content    /* 右侧内容区域 */
.node-content-layer    /* 内容层样式 */
.node-handles-container /* 连接点容器 */
.node-left-handles     /* 左侧连接点容器 */
.node-right-handles    /* 右侧连接点容器 */
.handle-label; /* 连接点标签 */
```

#### 样式改进

- 使用 Flexbox 实现左右布局
- 绝对定位实现连接点对齐
- CSS 变量实现主题化
- 动画和过渡效果

### 2. 组件架构重构

#### BaseNodeTemplate 重构

- 支持 `leftLayers` 和 `rightLayers` 数据结构
- 新增连接点对齐算法
- 支持连接点标签显示
- 移除旧的 `customBody` 属性，新增 `customLeftContent` 和 `customRightContent`

#### 节点组件更新

- 所有节点组件适配新的数据结构
- 更新连接点配置，支持 `layerIndex` 和 `label`
- 提供默认的左右两侧内容层

### 3. 数据结构重构

#### 新的数据格式

```javascript
const nodeData = {
  label: "节点标题",
  leftLayers: [
    { label: "输入层1", content: "输入内容1" },
    { label: "输入层2", content: "输入内容2" },
  ],
  rightLayers: [
    { label: "输出层1", content: "输出内容1" },
    { label: "输出层2", content: "输出内容2" },
  ],
};
```

#### 连接点配置

```javascript
const handles = [
  {
    type: "target", // 'target' 或 'source'
    position: "left", // 'left' 或 'right'
    id: "unique-id", // 唯一标识符
    label: "连接点标签", // 可选，显示标签
    layerIndex: 0, // 对应内容层的索引
  },
];
```

## 文件变更清单

### 重构的文件

1. **NodeStyles.css** - 完全重构样式系统
2. **BaseNodeTemplate.js** - 重构组件逻辑和布局
3. **TextNode.js** - 适配新数据结构
4. **ChapterNode.js** - 适配新数据结构
5. **GenerateNode.js** - 适配新数据结构
6. **ExampleCustomNode.js** - 展示多层结构功能
7. **NodeStyleTest.js** - 更新测试组件
8. **NodeSystemTest.js** - 更新系统测试
9. **README.md** - 更新文档说明

### 新增功能

- 多层结构支持
- 连接点标签显示
- 增强的视觉效果
- 响应式设计优化

## 使用示例

### 基础节点

```javascript
const basicNodeData = {
  label: "文本节点",
  leftLayers: [{ label: "文本输入", content: "输入文本内容" }],
  rightLayers: [{ label: "文本输出", content: "输出文本内容" }],
};
```

### 多层节点

```javascript
const multiLayerData = {
  label: "多层节点",
  leftLayers: [
    { label: "输入层1", content: "输入内容1" },
    { label: "输入层2", content: "输入内容2" },
    { label: "输入层3", content: "输入内容3" },
  ],
  rightLayers: [
    { label: "输出层1", content: "输出内容1" },
    { label: "输出层2", content: "输出内容2" },
  ],
};
```

### 自定义连接点

```javascript
const handles = [
  {
    type: "target",
    position: "left",
    id: "input-1",
    label: "输入1",
    layerIndex: 0,
  },
  {
    type: "source",
    position: "right",
    id: "output-1",
    label: "输出1",
    layerIndex: 0,
  },
];
```

## 测试验证

### 测试组件

- **NodeStyleTest.js** - 展示所有节点类型的样式
- **NodeSystemTest.js** - 系统级测试页面
- **ExampleCustomNode.js** - 多层结构示例

### 测试内容

- ✅ 基础节点类型显示
- ✅ 多层结构功能
- ✅ 连接点对齐
- ✅ 响应式设计
- ✅ 视觉效果
- ✅ 交互反馈

## 向后兼容性

### 兼容性说明

- 旧的数据结构仍然支持，但建议迁移到新格式
- 旧的连接点配置仍然有效，但建议添加 `layerIndex` 和 `label`
- 所有现有节点组件保持功能完整

### 迁移建议

1. 将 `content` 字段迁移到 `leftLayers` 和 `rightLayers`
2. 为连接点添加 `layerIndex` 属性
3. 考虑添加连接点标签提高可读性
4. 利用多层结构优化复杂节点

## 性能影响

### 性能优化

- 使用 CSS 变量减少重复样式
- 优化渲染算法，减少不必要的计算
- 合理的组件拆分和缓存策略

### 性能指标

- 节点渲染时间：无明显影响
- 内存使用：轻微增加（由于更复杂的结构）
- 交互响应：有所改善（更好的视觉反馈）

## 未来扩展

### 可能的改进方向

1. **动态层管理** - 运行时添加/删除内容层
2. **层间连接** - 支持层与层之间的连接
3. **自定义层样式** - 为不同层设置不同样式
4. **层折叠功能** - 支持折叠/展开内容层
5. **拖拽排序** - 支持拖拽重新排列内容层

### 技术债务

- 需要更新相关的测试用例
- 可能需要调整其他依赖节点系统的组件
- 建议逐步迁移现有项目到新格式

## 总结

本次重构成功实现了节点系统的现代化改造，提供了：

1. **更好的用户体验** - 清晰的左右布局和直观的数据流
2. **更强的功能性** - 多层结构支持复杂业务逻辑
3. **更高的可维护性** - 统一的组件架构和清晰的代码结构
4. **更好的扩展性** - 为未来功能扩展奠定基础

重构后的节点系统不仅满足了当前需求，还为未来的功能扩展提供了良好的基础架构。
